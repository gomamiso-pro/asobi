<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Web設計ヒアリングシート（プレビュー＆見積版）</title>
<style>
body { font-family:'Noto Sans JP', sans-serif; background:#fafafa; margin:0; padding:10px; color:#222; }
h1 { text-align:center; margin-bottom:20px; }
section { background:#fff; padding:15px; border-radius:10px; margin-top:10px; box-shadow:0 2px 6px rgba(0,0,0,0.05); }
h2 { margin-top:20px; color:#1a73e8; font-size:1.2rem; padding:8px; background:#e8f0fe; border-radius:6px; }
h3 { font-size:1rem; color:#333; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center; }
label { display:block; margin-top:5px; font-weight:700; }
select, textarea, input[type=text] { width:100%; padding:8px; margin-top:5px; border-radius:6px; border:1px solid #ccc; font-size:0.9rem; }
input[type=checkbox] { margin-right:5px; }
button { margin-top:10px; padding:10px 12px; border:none; border-radius:8px; background:#333; color:white; font-size:1rem; cursor:pointer; }
button:hover { background:#555; }
.delete-btn { background:#e53935; margin:0; padding:3px 6px; font-size:0.8rem; border-radius:4px; }
.delete-btn:hover { background:#b71c1c; }
pre { background:#f0f0f0; padding:10px; border-radius:6px; margin-top:10px; white-space:pre-wrap; word-break:break-word; }
.page-container { display:flex; overflow-x:auto; gap:10px; padding:10px 0; }
.page-card { min-width:280px; background:#fdfdfd; border:1px solid #ddd; border-radius:8px; padding:10px; flex-shrink:0; position:relative; }
.section-title { font-weight:700; margin-top:8px; }
table { width:100%; border-collapse:collapse; margin-top:10px; min-width:600px; }
th, td { border:1px solid #ddd; padding:8px; text-align:left; }
th { background:#f5f5f5; font-weight:700; }
iframe { width:100%; height:300px; border:1px solid #ccc; border-radius:8px; margin-top:10px; }
@media screen and (max-width:600px){
  body { padding:5px; }
  h1 { font-size:1.4rem; }
  h2 { font-size:1rem; }
  select, textarea, input[type=text] { font-size:0.85rem; }
  button { font-size:0.9rem; padding:8px; }
  .page-card { min-width:220px; }
  table { font-size:0.85rem; }
}
</style>
</head>
<body>

<h1>Web設計ヒアリングシート（プレビュー＆見積版）</h1>

<section>
  <h2>基本設定</h2>
  <!-- 既存8項目と運用統合項目 -->
  <label>プロジェクト概要（任意）</label>
  <textarea id="projectOverviewInput" placeholder="未入力の場合はおまかせ"></textarea>

  <label>ページ分類</label>
  <select id="pageTypeSelect">
    <option value="コーポレート／ブランド">コーポレート／ブランド</option>
    <option value="EC・販売サイト">EC・販売サイト</option>
    <option value="メディア・ブログ">メディア・ブログ</option>
    <option value="業務システム">業務システム</option>
    <option value="LP・キャンペーン">LP・キャンペーン</option>
    <option value="ポータル・コミュニティ">ポータル・コミュニティ</option>
    <option value="おまかせ">おまかせ</option>
  </select>

  <label>各ページの目的</label>
  <textarea id="pagePurposeInput" placeholder="未入力の場合はおまかせ"></textarea>

  <label>ユーザー層・想定デバイス</label>
  <select id="userTargetSelect">
    <option value="一般ユーザー（20〜40代）">一般ユーザー（20〜40代）</option>
    <option value="BtoB企業">BtoB企業</option>
    <option value="管理者／社内利用">管理者／社内利用</option>
    <option value="学生／若年層">学生／若年層</option>
    <option value="高齢層中心">高齢層中心</option>
    <option value="おまかせ">おまかせ</option>
  </select>

  <label>デザイン方針</label>
  <select id="designSelect">
    <option value="シンプル＆ミニマル">シンプル＆ミニマル</option>
    <option value="ビジネス＆信頼重視">ビジネス＆信頼重視</option>
    <option value="ポップ＆カジュアル">ポップ＆カジュアル</option>
    <option value="高級・スタイリッシュ">高級・スタイリッシュ</option>
    <option value="自然・ナチュラル">自然・ナチュラル</option>
    <option value="おまかせ">おまかせ</option>
  </select>

  <label>データ・連携・管理要件</label>
  <textarea id="dataRequirementInput" placeholder="未入力の場合はおまかせ"></textarea>

  <label>運用・更新・公開</label>
  <textarea id="operationInput" placeholder="更新方法や管理権限など、未入力の場合はおまかせ"></textarea>

  <label>使用言語（複数選択可）</label>
  <label><input type="checkbox" id="lang_html" value="HTML">HTML</label>
  <label><input type="checkbox" id="lang_css" value="CSS">CSS</label>
  <label><input type="checkbox" id="lang_js" value="JavaScript">JavaScript</label>
  <label><input type="checkbox" id="lang_python" value="Python">Python</label>
  <label><input type="checkbox" id="lang_php" value="PHP">PHP</label>
  <label><input type="checkbox" id="lang_ruby" value="Ruby">Ruby</label>

  <label>サーバー（無料〜有料）</label>
  <select id="serverSelect">
    <option value="さくらレンタルサーバー">さくらレンタルサーバー</option>
    <option value="XServer">XServer</option>
    <option value="AWS">AWS</option>
    <option value="Firebase">Firebase</option>
    <option value="Vercel">Vercel</option>
    <option value="おまかせ">おまかせ</option>
  </select>

  <label>データベース</label>
  <select id="databaseSelect">
    <option value="MySQL">MySQL</option>
    <option value="PostgreSQL">PostgreSQL</option>
    <option value="SQLite">SQLite</option>
    <option value="Firebase">Firebase</option>
    <option value="おまかせ">おまかせ</option>
  </select>

  <label>デザインフレームワーク</label>
  <select id="designFrameworkSelect">
    <option value="Bootstrap">Bootstrap</option>
    <option value="Tailwind">Tailwind</option>
    <option value="Material UI">Material UI</option>
    <option value="おまかせ">おまかせ</option>
  </select>

  <label>認証方式</label>
  <select id="authSelect">
    <option value="メール認証">メール認証</option>
    <option value="OAuth">OAuth</option>
    <option value="SSO">SSO</option>
    <option value="おまかせ">おまかせ</option>
  </select>

  <label>公開・セキュリティ・拡張性</label>
  <textarea id="securityInput" placeholder="未入力の場合はおまかせ"></textarea>
</section>

<section>
  <h2>ページ設定</h2>
  <button onclick="addPage()">＋ ページ追加</button>
  <div class="page-container" id="pageContainer"></div>
</section>

<section>
  <h2>プレビュー</h2>
  <button onclick="showPreview()">プレビュー表示</button>
  <iframe id="iframePreview"></iframe>
</section>

<section>
  <h2>見積金額明細</h2>
  <table id="estimateTable">
    <thead>
      <tr><th>項目</th><th>単価</th><th>数量</th><th>小計</th></tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr><th colspan="3">合計（税抜）</th><th id="subtotal">0</th></tr>
      <tr><th colspan="3">合計（税込10%）</th><th id="total">0</th></tr>
    </tfoot>
  </table>
</section>

<section>
  <h2>生成結果（JSON形式）</h2>
  <pre id="jsonOutput">{}</pre>
</section>

<script>
let pageCount = 0;
const sectionOptions = {
  header: ["ロゴ", "検索ボックス", "通知アイコン", "言語切替", "ログインボタン"],
  menu: ["カテゴリメニュー", "ドロップダウン", "パンくずリスト", "サイドメニュー"],
  body: ["カルーセル", "新着商品一覧", "特集バナー", "記事リスト", "フォーム"],
  footer: ["会社情報", "SNSリンク", "コピーライト", "フッターメニュー"]
};

function createSectionCheckboxes(sectionName, idPrefix, options){
  let html = `<div class="section-title">${sectionName}</div>`;
  options.forEach((opt,i)=>{
    html += `<label><input type="checkbox" id="${idPrefix}_${i}" value="${opt}">${opt}</label>`;
  });
  return html;
}

function addPage() {
  pageCount++;
  const container = document.getElementById('pageContainer');
  const card = document.createElement('div');
  card.className = 'page-card';
  card.id = `pageCard${pageCount}`;
  card.innerHTML = `
    <h3>ページ${pageCount} <button class="delete-btn" onclick="deletePage(${pageCount})">削除</button></h3>
    <label>ページ名</label>
    <input type="text" id="pageName${pageCount}" placeholder="例: トップページ">
    ${createSectionCheckboxes("ヘッダー", `header${pageCount}`, sectionOptions.header)}
    ${createSectionCheckboxes("メニュー", `menu${pageCount}`, sectionOptions.menu)}
    ${createSectionCheckboxes("ボディ", `body${pageCount}`, sectionOptions.body)}
    ${createSectionCheckboxes("フッター", `footer${pageCount}`, sectionOptions.footer)}
  `;
  container.appendChild(card);
  updateEstimate();
}

function deletePage(id){
  const card = document.getElementById(`pageCard${id}`);
  if(card) card.remove();
  updateEstimate();
}

function showPreview(){
  const pages = [];
  for(let i=1;i<=pageCount;i++){
    const card = document.getElementById(`pageCard${i}`);
    if(!card) continue;
    const pageName = document.getElementById(`pageName${i}`).value || `ページ${i}`;
    const header = Array.from(card.querySelectorAll(`[id^=header${i}_]:checked`)).map(e=>e.value);
    const menu = Array.from(card.querySelectorAll(`[id^=menu${i}_]:checked`)).map(e=>e.value);
    const body = Array.from(card.querySelectorAll(`[id^=body${i}_]:checked`)).map(e=>e.value);
    const footer = Array.from(card.querySelectorAll(`[id^=footer${i}_]:checked`)).map(e=>e.value);
    pages.push({pageName, header, menu, body, footer});
  }

  let html = '';
  pages.forEach(p=>{
    html += `<h2>${p.pageName}</h2>`;
    html += `<div><strong>ヘッダー:</strong> ${p.header.join(", ") || "なし"}</div>`;
    html += `<div><strong>メニュー:</strong> ${p.menu.join(", ") || "なし"}</div>`;
    html += `<div><strong>ボディ:</strong> ${p.body.join(", ") || "なし"}</div>`;
    html += `<div><strong>フッター:</strong> ${p.footer.join(", ") || "なし"}</div>`;
    html += `<hr>`;
  });

  document.getElementById('iframePreview').srcdoc = html;

  // JSON出力
  const output = {
    projectOverview: document.getElementById('projectOverviewInput').value || "おまかせ",
    pageType: document.getElementById('pageTypeSelect').value,
    pagePurpose: document.getElementById('pagePurposeInput').value || "おまかせ",
    userTarget: document.getElementById('userTargetSelect').value,
    design: document.getElementById('designSelect').value,
    dataRequirement: document.getElementById('dataRequirementInput').value || "おまかせ",
    operation: document.getElementById('operationInput').value || "おまかせ",
    languages: Array.from(document.querySelectorAll('[id^=lang_]:checked')).map(e=>e.value),
    server: document.getElementById('serverSelect').value,
    database: document.getElementById('databaseSelect').value,
    designFramework: document.getElementById('designFrameworkSelect').value,
    auth: document.getElementById('authSelect').value,
    security: document.getElementById('securityInput').value || "おまかせ",
    pages: pages
  };
  document.getElementById('jsonOutput').textContent = JSON.stringify(output, null, 2);
  updateEstimate();
}

function updateEstimate(){
  const tbody = document.querySelector('#estimateTable tbody');
  tbody.innerHTML = '';
  let subtotal = 0;

  // 基本設計
  const basic = 50000;
  subtotal += basic;
  tbody.innerHTML += `<tr><td>基本設計</td><td>${basic}</td><td>1</td><td>${basic}</td></tr>`;

  // ページ追加
  const pageUnit = 30000;
  const pages = document.querySelectorAll('.page-card').length;
  subtotal += pageUnit * pages;
  if(pages>0) tbody.innerHTML += `<tr><td>ページ追加</td><td>${pageUnit}</td><td>${pages}</td><td>${pageUnit*pages}</td></tr>`;

  // 各セクション（ヘッダー・メニュー・ボディ・フッター） 1セクション1万
  const sectionUnit = 10000;
  let sectionCount = 0;
  for(let i=1;i<=pageCount;i++){
    const card = document.getElementById(`pageCard${i}`);
    if(!card) continue;
    sectionCount += card.querySelectorAll('input[type=checkbox]:checked').length;
  }
  subtotal += sectionUnit * sectionCount;
  if(sectionCount>0) tbody.innerHTML += `<tr><td>セクション追加</td><td>${sectionUnit}</td><td>${sectionCount}</td><td>${sectionUnit*sectionCount}</td></tr>`;

  // データベース・認証・フレームワークまとめて 2万
  const extraUnit = 20000;
  subtotal += extraUnit;
  tbody.innerHTML += `<tr><td>データ・認証・フレームワーク設定</td><td>${extraUnit}</td><td>1</td><td>${extraUnit}</td></tr>`;

  document.getElementById('subtotal').textContent = subtotal;
  document.getElementById('total').textContent = Math.round(subtotal*1.1);
}
</script>

</body>
  </html>
